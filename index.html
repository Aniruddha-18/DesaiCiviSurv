<!-- Filename: survey-gallery-fixed.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DESAI CiviSurv — Live Survey Gallery</title>
  <style>
    :root{
      --bg:#2C3E50;
      --accent:#04AA6D;
      --blue:#0070C0;
      --muted:#36454F;
      --white:#ffffff;
    }

    /* Reset + base */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "Palatino Linotype", serif;
      background:var(--bg);
      color:var(--white);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Header */
    header{
      background:var(--muted);
      padding:12px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    header img{width:150px;height:auto;display:block}
    nav{margin-right:10px}
    nav a{
      font-size:16px;
      background:var(--accent);
      color:var(--white);
      padding:10px 18px;
      margin:4px;
      border-radius:25px;
      text-decoration:none;
      font-weight:700;
      border:2px solid var(--white);
      display:inline-block;
      transition:all .25s ease;
    }
    nav a:hover{background:var(--white); color:var(--accent); transform:scale(1.05)}

    /* Title + description */
    .main-title{ text-align:center; margin-top:34px; padding:0 18px }
    .main-title h1{font-size:42px;margin:0;color:var(--white)}
    .main-title h2{
      display:inline-block;
      background:var(--white);
      color:var(--blue);
      padding:10px;
      border-radius:10px;
      margin-top:10px;
      font-size:20px;
    }

    .description{
      max-width:900px;
      margin:28px auto;
      text-align:center;
      padding:18px;
      color:var(--white);
      font-size:16px;
      line-height:1.6;
      background:linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border-radius:10px;
      box-shadow:0 0 12px rgba(255,255,255,0.03);
    }

    .marquee-container{width:100%; background:var(--accent); padding:10px 0; margin-top:14px}
    .marquee-text{display:inline-block; color:#fff; font-weight:700; animation: marquee 12s linear infinite}
    @keyframes marquee{from{transform:translateX(100%)} to{transform:translateX(-100%)}}

    .nav-button{
      display:block;
      margin:20px auto;
      background:var(--white);
      color:var(--blue);
      border:2px solid var(--blue);
      padding:10px 14px;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
    }

    /* Section title style requested */
    .section-title{
      text-align:center;
      background:var(--white);
      color:var(--blue);
      padding:10px;
      font-size:18px;
      border:2px solid var(--blue);
      border-radius:10px;
      margin:22px auto;
      width:max-content;
      cursor:default;
      font-weight:700;
    }

    /* Gallery grid */
    .parent-container{max-width:1100px;margin:10px auto;padding:20px}
    .image-container{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
      gap:12px;
      align-items:center;
      justify-items:center;
    }
    .image-container img{
      width:100%;
      max-width:220px;
      height:auto;
      border-radius:10px;
      border:3px solid #fff;
      box-shadow:0 6px 18px rgba(0,0,0,0.3);
      cursor:pointer;
      transition:transform .25s ease, opacity .25s ease;
    }
    .image-container img:hover{transform:scale(1.03); opacity:.95}

    .view-more-btn{
      display:block;
      margin:18px auto 40px;
      padding:10px 18px;
      background:var(--blue);
      color:#fff;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-weight:700;
    }
    .view-more-btn:active{transform:translateY(1px)}

    .hidden{display:none !important}

    /* Lightbox */
    #lightbox-modal{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.86);
      z-index:9999;
      align-items:center;
      justify-content:center;
      padding:30px;
    }
    #lightbox-container{
      max-width:95%;
      max-height:90vh;
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    #lightbox-image{
      max-width:100%;
      max-height:90vh;
      border-radius:8px;
      box-shadow:0 20px 50px rgba(0,0,0,0.6);
    }
    .lightbox-control{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      background:rgba(0,0,0,0.5);
      color:#fff;
      border:none;
      padding:10px 14px;
      font-size:26px;
      cursor:pointer;
      border-radius:8px;
    }
    .lightbox-control:focus{outline:2px solid rgba(255,255,255,0.5)}
    .prev{left:10px}
    .next{right:10px}
    .lightbox-close{
      position:absolute;
      top:10px;
      right:10px;
      background:rgba(0,0,0,0.4);
      color:#fff;
      border:none;
      padding:8px 10px;
      border-radius:6px;
      cursor:pointer;
      font-size:18px;
    }

    /* Footer */
    footer{
      text-align:center;
      color:#fff;
      background:var(--muted);
      padding:20px;
      margin-top:30px;
    }

    /* Responsive tweaks */
    @media (max-width:600px){
      .image-container{grid-template-columns:repeat(2,1fr)}
      header img{width:120px}
      .main-title h1{font-size:28px}
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <img src="F_logo_dcs.cs.Model.1.jpg" alt="DESAI CiviSurv Logo">
    <nav aria-label="Main navigation">
      <a href="index.php">Home</a>
      <a href="about.html">About us</a>
      <a href="services.html">Services</a>
      <a href="contact.php">Contact us</a>
    </nav>
  </header>

  <main>
    <section class="main-title">
      <h1>DESAI CiviSurv</h1>
      <h2>Consulting Civil Engineer's & Surveyor's</h2>
    </section>

    <p class="description">
      A Civil Engineer designs, builds, and maintains infrastructure projects and systems. A Surveyor measures and maps the Earth's physical features — crucial for construction and land development.
    </p>

    <div class="marquee-container" aria-hidden="true">
      <div class="marquee-text">"Success is not the key to happiness. Happiness is the key to success."</div>
    </div>

    <button class="nav-button" onclick="window.open('Maps.html','_blank')">MAPS OF SURVEY</button>

    <h2 class="section-title">Live Pictures of Survey</h2>

    <div class="parent-container" id="gallery-root">
      <!-- Visible thumbnails -->
      <div class="image-container" id="thumbs-top">
        <img src="images/abhi7.jpeg" alt="Survey image 7">
        <img src="images/abhi2.jpeg" alt="Survey image 2">
        <img src="images/abhi6.jpeg" alt="Survey image 6">
        <img src="images/abhi4.jpeg" alt="Survey image 4">
      </div>

      <!-- Hidden thumbnails that will show after View More -->
      <div class="image-container hidden" id="more-images">
        <img src="images/abhi5.jpeg" alt="Survey image 5">
        <img src="images/abhi3.jpeg" alt="Survey image 3">
        <img src="images/abhi1.jpeg" alt="Survey image 1">
        <img src="images/abhi8.jpeg" alt="Survey image 8">
        <img src="images/abhi9.jpeg" alt="Survey image 9">
        <img src="images/abhi10.jpeg" alt="Survey image 10">
        <img src="images/abhi11.jpeg" alt="Survey image 11">
        <img src="images/abhi12.jpeg" alt="Survey image 12">
        <img src="images/abhi13.jpeg" alt="Survey image 13">
        <img src="images/abhi14.jpeg" alt="Survey image 14">
        <img src="images/abhi15.jpeg" alt="Survey image 15">
        <img src="images/abhi16.jpeg" alt="Survey image 16">
      </div>

      <button class="view-more-btn" id="toggleMoreBtn" aria-expanded="false">View More</button>
    </div>
  </main>

  <!-- LIGHTBOX -->
  <div id="lightbox-modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div id="lightbox-container">
      <button class="lightbox-close" id="lightboxClose" aria-label="Close (ESC)">✕</button>
      <button class="lightbox-control prev" id="lightboxPrev" aria-label="Previous (Left arrow)">❮</button>
      <img id="lightbox-image" src="" alt="Enlarged survey picture">
      <button class="lightbox-control next" id="lightboxNext" aria-label="Next (Right arrow)">❯</button>
    </div>
  </div>

  <footer>
    <p>&copy; 2023 DESAI CiviSurv. All Rights Reserved.</p>
  </footer>

  <script>
    (function(){
      // Elements
      const toggleBtn = document.getElementById('toggleMoreBtn');
      const moreImages = document.getElementById('more-images');
      const modal = document.getElementById('lightbox-modal');
      const lightboxImage = document.getElementById('lightbox-image');
      const prevBtn = document.getElementById('lightboxPrev');
      const nextBtn = document.getElementById('lightboxNext');
      const closeBtn = document.getElementById('lightboxClose');

      // Build a single array of all thumbnails (top visible + hidden)
      const thumbContainers = Array.from(document.querySelectorAll('#gallery-root .image-container'));
      let thumbs = [];
      thumbContainers.forEach(container => {
        thumbs = thumbs.concat(Array.from(container.querySelectorAll('img')));
      });

      // Assign data-index and click handler to each thumbnail
      thumbs.forEach((img, idx) => {
        img.dataset.index = idx;
        img.addEventListener('click', () => openModal(idx));
      });

      let currentIndex = 0;

      function openModal(index){
        currentIndex = index;
        lightboxImage.src = thumbs[currentIndex].src;
        modal.style.display = 'flex';
        modal.setAttribute('aria-hidden','false');
        document.body.style.overflow = 'hidden'; // prevent background scroll
        // focus for accessibility
        closeBtn.focus();
      }

      function closeModal(){
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden','true');
        document.body.style.overflow = ''; // restore scroll
      }

      function changeImage(dir){
        if (!thumbs.length) return;
        currentIndex = (currentIndex + dir + thumbs.length) % thumbs.length;
        // smooth change
        lightboxImage.src = thumbs[currentIndex].src;
      }

      // Overlay click to close (only when clicking backdrop)
      modal.addEventListener('click', function(e){
        if (e.target === modal) closeModal();
      });

      // Prev/Next handlers (stop propagation so they don't trigger overlay close)
      prevBtn.addEventListener('click', (e) => { e.stopPropagation(); changeImage(-1); });
      nextBtn.addEventListener('click', (e) => { e.stopPropagation(); changeImage(1); });
      closeBtn.addEventListener('click', () => closeModal());

      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (modal.style.display === 'flex') {
          if (e.key === 'Escape') closeModal();
          if (e.key === 'ArrowRight') changeImage(1);
          if (e.key === 'ArrowLeft') changeImage(-1);
        }
      });

      // Toggle view more/less
      toggleBtn.addEventListener('click', () => {
        const isHidden = moreImages.classList.toggle('hidden');
        toggleBtn.textContent = isHidden ? 'View More' : 'View Less';
        toggleBtn.setAttribute('aria-expanded', String(!isHidden));
      });

      // Defensive: if images fail to load, hide modal gracefully
      lightboxImage.addEventListener('error', () => {
        alert('This image failed to load.');
        closeModal();
      });

      // optional: lazy-load images (simple)
      thumbs.forEach(img => img.loading = 'lazy');

    })();
  </script>
</body>
</html>

